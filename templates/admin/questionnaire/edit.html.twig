{% extends 'admin/base.html.twig' %}

{% block title %}Modifier - {{ questionnaire.nom }}{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- En-tête -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h4 class="mb-0 fw-semibold">
                        <i class="fas fa-edit me-2 text-warning"></i>Modifier le questionnaire
                    </h4>
                    <p class="text-sm text-muted mb-0 mt-1">
                        {{ questionnaire.nom }} - <code class="text-muted">{{ questionnaire.code }}</code>
                    </p>
                </div>
                <a href="{{ path('admin_questionnaire_show', {'id': questionnaire.questionnaireId}) }}" 
                   class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Retour
                </a>
            </div>

            <!-- Messages flash -->
            {% for message in app.flashes('error') %}
                <div class="alert alert-danger alert-dismissible fade show mb-3">{{ message }}</div>
            {% endfor %}
            {% for message in app.flashes('success') %}
                <div class="alert alert-success alert-dismissible fade show mb-3">{{ message }}</div>
            {% endfor %}

            <!-- ✅ Alerte informative - PAS une erreur de validation -->
            {% if questionnaire.questions|length == 0 %}
                <div class="alert alert-warning mb-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Aucune question</strong> - Ce questionnaire n'a pas encore de questions.
                    <a href="{{ path('admin_question_new', {'questionnaire_id': questionnaire.questionnaireId}) }}" 
                       class="alert-link fw-bold ms-2">
                        Ajouter des questions
                    </a>
                </div>
            {% endif %}

            <!-- Formulaire -->
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

                    <!-- Informations générales -->
                    <div class="mb-4">
                        <h6 class="fw-semibold mb-3 pb-2 border-bottom">
                            <i class="fas fa-info-circle me-2 text-primary"></i>Informations générales
                        </h6>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ form_label(form.nom, 'Nom *') }}
                                {{ form_widget(form.nom, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(form.nom) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_label(form.code, 'Code') }}
                                {{ form_widget(form.code, {'attr': {'class': 'form-control', 'readonly': true}}) }}
                            </div>
                        </div>

                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                {{ form_label(form.type, 'Type *') }}
                                {{ form_widget(form.type, {'attr': {'class': 'form-select'}}) }}
                                {{ form_errors(form.type) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_label(form.nbre_questions, 'Nombre de questions *') }}
                                {{ form_widget(form.nbre_questions, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(form.nbre_questions) }}
                                <small class="text-muted">
                                    Actuellement {{ questionnaire.questions|length }} question(s)
                                </small>
                            </div>
                        </div>

                        <div class="mt-3">
                            {{ form_label(form.description, 'Description') }}
                            {{ form_widget(form.description, {'attr': {'class': 'form-control', 'rows': 3}}) }}
                            {{ form_errors(form.description) }}
                        </div>
                    </div>

                    <!-- Seuils -->
                    <div class="mb-4">
                        <h6 class="fw-semibold mb-3 pb-2 border-bottom">
                            <i class="fas fa-sliders-h me-2 text-primary"></i>Seuils
                        </h6>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                {{ form_label(form.seuil_leger, 'Seuil léger *') }}
                                {{ form_widget(form.seuil_leger, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(form.seuil_leger) }}
                            </div>
                            <div class="col-md-4">
                                {{ form_label(form.seuil_modere, 'Seuil modéré *') }}
                                {{ form_widget(form.seuil_modere, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(form.seuil_modere) }}
                            </div>
                            <div class="col-md-4">
                                {{ form_label(form.seuil_severe, 'Seuil sévère *') }}
                                {{ form_widget(form.seuil_severe, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(form.seuil_severe) }}
                            </div>
                        </div>
                    </div>

                    <!-- Interprétations -->
                    <div class="mb-4">
                        <h6 class="fw-semibold mb-3 pb-2 border-bottom">
                            <i class="fas fa-comment-dots me-2 text-primary"></i>Interprétations
                        </h6>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                {{ form_label(form.interpretat_legere, 'Niveau léger') }}
                                {{ form_widget(form.interpretat_legere, {'attr': {'class': 'form-control', 'rows': 3}}) }}
                                {{ form_errors(form.interpretat_legere) }}
                            </div>
                            <div class="col-md-4">
                                {{ form_label(form.interpretat_modere, 'Niveau modéré') }}
                                {{ form_widget(form.interpretat_modere, {'attr': {'class': 'form-control', 'rows': 3}}) }}
                                {{ form_errors(form.interpretat_modere) }}
                            </div>
                            <div class="col-md-4">
                                {{ form_label(form.interpretat_severe, 'Niveau sévère') }}
                                {{ form_widget(form.interpretat_severe, {'attr': {'class': 'form-control', 'rows': 3}}) }}
                                {{ form_errors(form.interpretat_severe) }}
                            </div>
                        </div>
                    </div>

                    <!-- Boutons -->
                    <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                        <a href="{{ path('admin_questionnaire_show', {'id': questionnaire.questionnaireId}) }}" 
                           class="btn btn-outline-secondary">
                            Annuler
                        </a>
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-save me-1"></i>Enregistrer
                        </button>
                    </div>

                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}