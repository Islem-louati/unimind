{# templates/dashboard/etudiant/consultations/index.html.twig #}
{% extends 'base_etudiant.html.twig' %}

{% block title %}Mes Consultations | UniMind{% endblock %}
{% block page_title %}Mes Consultations{% endblock %}

{% block breadcrumb_icon %}fa-file-medical{% endblock %}
{% block page_title_icon %}fa-file-medical{% endblock %}

{% block content %}
  {# Statistiques #}
  <div class="row">
    <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Total</p>
                <h5 class="font-weight-bolder">{{ stats.total }}</h5>
                <p class="mb-0">
                  <span class="text-sm">Consultations</span>
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                <i class="fas fa-file-medical text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Cette Année</p>
                <h5 class="font-weight-bolder">{{ stats.cette_annee }}</h5>
                <p class="mb-0">
                  <span class="text-sm">Consultations</span>
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                <i class="fas fa-calendar-alt text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Note Moyenne</p>
                <h5 class="font-weight-bolder">
                  {% if stats.note_moyenne %}
                    {{ stats.note_moyenne }}/5
                  {% else %}
                    N/A
                  {% endif %}
                </h5>
                <p class="mb-0">
                  <span class="text-sm">Satisfaction</span>
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                <i class="fas fa-star text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-sm-6">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Dernière</p>
                <h5 class="font-weight-bolder">
                  {% if stats.derniere_consultation %}
                    {{ stats.derniere_consultation|date('d/m/Y') }}
                  {% else %}
                    N/A
                  {% endif %}
                </h5>
                <p class="mb-0">
                  <span class="text-sm">Consultation</span>
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                <i class="fas fa-history text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {# Liste des consultations #}
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header pb-0">
          <h6>Historique de mes consultations</h6>
        </div>
        <div class="card-body px-0 pt-0 pb-2">
          {% if consultations is empty %}
            <div class="text-center py-5">
              <i class="fas fa-file-medical text-secondary" style="font-size: 3rem;"></i>
              <p class="text-secondary mt-3">Aucune consultation pour le moment</p>
              <a href="{{ path('app_etudiant_rdv') }}" class="btn btn-sm btn-primary mt-2">Prendre rendez-vous</a>
            </div>
          {% else %}
            <div class="table-responsive p-0">
              <table class="table align-items-center mb-0">
                <thead>
                  <tr>
                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Date</th>
                    <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Psychologue</th>
                    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Motif</th>
                    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Note</th>
                    <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for consultation in consultations %}
                    <tr>
                      <td>
                        <div class="d-flex px-2 py-1">
                          <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 text-sm">{{ consultation.dateRedaction|date('d/m/Y') }}</h6>
                            <p class="text-xs text-secondary mb-0">{{ consultation.dateRedaction|date('H:i') }}</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">Dr. {{ consultation.psy.nom }} {{ consultation.psy.prenom }}</p>
                        <p class="text-xs text-secondary mb-0">{{ consultation.psy.specialite ?? 'Psychologue' }}</p>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <p class="text-xs mb-0">{{ consultation.motifRendezVous|slice(0, 50) }}{% if consultation.motifRendezVous|length > 50 %}...{% endif %}</p>
                      </td>
                      <td class="align-middle text-center">
                        {% if consultation.noteSatisfaction %}
                          <span class="text-warning" style="font-size: 1.2rem;">
                            {% for i in 1..5 %}
                              {% if i <= consultation.noteSatisfaction %}
                                ★
                              {% else %}
                                ☆
                              {% endif %}
                            {% endfor %}
                          </span>
                          <p class="text-xs mt-1">{{ consultation.noteSatisfaction }}/5</p>
                        {% else %}
                          <span class="badge badge-sm badge-secondary">Non notée</span>
                        {% endif %}
                      </td>
                      <td class="align-middle text-center">
                        <a href="{{ path('app_etudiant_consultation_show', {id: consultation.consultationId}) }}" 
                           class="btn btn-link text-dark px-3 mb-0">
                          <i class="fas fa-eye text-dark me-2" aria-hidden="true"></i>Voir
                        </a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}