{% extends 'base2.html.twig' %}

{% block title %}Tableau de bord Étudiant{% endblock %}

{% block breadcrumb_current %}Dashboard{% endblock %}

{% block page_title %}Tableau de bord Étudiant{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  {# KPI - Statistiques principales #}
  <div class="row">
    <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Séances complétées</p>
                <h5 class="font-weight-bolder mb-0">
                  0
                </h5>
                <p class="mb-0">
                  <span class="text-success text-sm font-weight-bolder">+0%</span>
                  cette semaine
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                <i class="fas fa-check-circle text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Temps de méditation</p>
                <h5 class="font-weight-bolder mb-0">
                  0 min
                </h5>
                <p class="mb-0">
                  <span class="text-success text-sm font-weight-bolder">+0%</span>
                  cette semaine
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                <i class="fas fa-clock text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Séances favorites</p>
                <h5 class="font-weight-bolder mb-0">
                  0
                </h5>
                <p class="mb-0">
                  <span class="text-success text-sm font-weight-bolder">+0</span>
                  récemment
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                <i class="fas fa-heart text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-sm-6">
      <div class="card">
        <div class="card-body p-3">
          <div class="row">
            <div class="col-8">
              <div class="numbers">
                <p class="text-sm mb-0 text-uppercase font-weight-bold">Niveau</p>
                <h5 class="font-weight-bolder mb-0">
                  Débutant
                </h5>
                <p class="mb-0">
                  <span class="text-success text-sm font-weight-bolder">Progression</span>
                  0%
                </p>
              </div>
            </div>
            <div class="col-4 text-end">
              <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                <i class="fas fa-chart-line text-lg opacity-10" aria-hidden="true"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {# Cartes d'accès rapide #}
  <div class="row mt-4">
    <div class="col-lg-8 mb-lg-0 mb-4">
      <div class="card">
        <div class="card-header pb-0 p-3">
          <div class="d-flex justify-content-between">
            <h6 class="mb-2">Accès rapide</h6>
          </div>
        </div>
        <div class="card-body p-3">
          <div class="row">
            <div class="col-md-6 mb-md-0 mb-4">
              <div class="card card-body border card-plain border-radius-lg d-flex align-items-center flex-row">
                <div class="icon icon-shape icon-sm bg-gradient-primary shadow text-center border-radius-md me-3">
                  <i class="fas fa-spa text-white opacity-10"></i>
                </div>
                <div class="d-flex flex-column">
                  <h6 class="mb-1 text-dark text-sm">Séances de méditation</h6>
                  <a href="{{ path('etudiant_meditation_index') }}" class="text-primary text-sm font-weight-bold">
                    Accéder <i class="fas fa-arrow-right ms-1"></i>
                  </a>
                </div>
              </div>
            </div>
            
            <div class="col-md-6 mb-md-0 mb-4">
              <div class="card card-body border card-plain border-radius-lg d-flex align-items-center flex-row">
                <div class="icon icon-shape icon-sm bg-gradient-success shadow text-center border-radius-md me-3">
                  <i class="fas fa-comments text-white opacity-10"></i>
                </div>
                <div class="d-flex flex-column">
                  <h6 class="mb-1 text-dark text-sm">Forum d'échange</h6>
                  <a href="#" class="text-primary text-sm font-weight-bold">
                    Accéder <i class="fas fa-arrow-right ms-1"></i>
                  </a>
                </div>
              </div>
            </div>
            
            <div class="col-md-6 mb-md-0 mb-4">
              <div class="card card-body border card-plain border-radius-lg d-flex align-items-center flex-row">
                <div class="icon icon-shape icon-sm bg-gradient-info shadow text-center border-radius-md me-3">
                  <i class="fas fa-calendar-check text-white opacity-10"></i>
                </div>
                <div class="d-flex flex-column">
                  <h6 class="mb-1 text-dark text-sm">Rendez-vous</h6>
                  <a href="#" class="text-primary text-sm font-weight-bold">
                    Accéder <i class="fas fa-arrow-right ms-1"></i>
                  </a>
                </div>
              </div>
            </div>
            
            <div class="col-md-6 mb-md-0 mb-4">
              <div class="card card-body border card-plain border-radius-lg d-flex align-items-center flex-row">
                <div class="icon icon-shape icon-sm bg-gradient-warning shadow text-center border-radius-md me-3">
                  <i class="fas fa-chart-line text-white opacity-10"></i>
                </div>
                <div class="d-flex flex-column">
                  <h6 class="mb-1 text-dark text-sm">Suivi bien-être</h6>
                  <a href="#" class="text-primary text-sm font-weight-bold">
                    Accéder <i class="fas fa-arrow-right ms-1"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="card-header pb-0 p-3">
          <h6>Votre progression</h6>
        </div>
        <div class="card-body p-3">
          <div class="chart">
            <div class="text-center">
              <div class="position-relative d-inline-block">
                <div class="position-absolute top-50 start-50 translate-middle">
                  <span class="text-lg font-weight-bold">0%</span>
                  <p class="text-xs mb-0">Complété</p>
                </div>
                <canvas id="progressChart" width="200" height="200"></canvas>
              </div>
            </div>
            <div class="text-center mt-4">
              <p class="text-sm mb-1">
                <i class="fas fa-info-circle text-info me-1"></i>
                Commencez votre première séance pour suivre votre progression
              </p>
              <a href="{{ path('etudiant_meditation_index') }}" class="btn btn-sm btn-primary mb-0">
                <i class="fas fa-play me-1"></i> Démarrer
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {# Recommandations #}
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header pb-0">
          <h6>Recommandations pour vous</h6>
          <p class="text-sm mb-0">
            <i class="fas fa-lightbulb text-warning me-1"></i>
            Séances adaptées à votre niveau débutant
          </p>
        </div>
        <div class="card-body px-0 pt-0 pb-2">
          <div class="table-responsive p-0">
            <table class="table align-items-center mb-0">
              <thead>
                <tr>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Séance recommandée</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Durée</th>
                  <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Niveau</th>
                  <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Catégorie</th>
                  <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="5" class="text-center py-4">
                    <div class="avatar avatar-xl bg-gradient-info rounded-circle mx-auto mb-3">
                      <i class="fas fa-headphones text-white text-2xl"></i>
                    </div>
                    <h6 class="text-gradient text-info mb-0">Aucune recommandation</h6>
                    <p class="text-sm mb-4">Explorez nos séances pour obtenir des recommandations personnalisées</p>
                    <a href="{{ path('etudiant_meditation_index') }}" class="btn btn-info btn-sm">
                      <i class="fas fa-compass me-1"></i> Explorer les séances
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {# Dernières activités #}
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header pb-0">
          <h6>Dernières activités</h6>
          <p class="text-sm mb-0">
            <i class="fas fa-history text-info me-1"></i>
            Votre historique d'activités
          </p>
        </div>
        <div class="card-body px-0 pt-0 pb-2">
          <div class="table-responsive p-0">
            <table class="table align-items-center mb-0">
              <thead>
                <tr>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Activité</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Date</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Statut</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="d-flex px-2 py-1">
                      <div>
                        <div class="avatar avatar-sm bg-gradient-info me-3 d-flex align-items-center justify-content-center">
                          <i class="fas fa-user text-white text-xs"></i>
                        </div>
                      </div>
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="mb-0 text-sm">Bienvenue sur UniMind !</h6>
                        <p class="text-xs text-secondary mb-0">
                          Votre compte étudiant a été activé
                        </p>
                      </div>
                    </div>
                  </td>
                  <td>
                    <p class="text-sm font-weight-bold mb-0">
                      {{ "now"|date('d/m/Y') }}
                    </p>
                    <p class="text-xs text-secondary mb-0">
                      {{ "now"|date('H:i') }}
                    </p>
                  </td>
                  <td>
                    <span class="badge badge-sm bg-gradient-success">
                      Complet
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="card-footer">
          <div class="text-center">
            <p class="text-sm text-secondary mb-0">
              <i class="fas fa-info-circle me-1"></i>
              Commencez à utiliser l'application pour voir votre historique
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{# Message de bienvenue modal #}
<div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-gradient-primary">
        <h5 class="modal-title text-white" id="welcomeModalLabel">
          <i class="fas fa-heart me-2"></i>Bienvenue sur UniMind !
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <div class="avatar avatar-xl bg-gradient-info rounded-circle mx-auto mb-3">
            <i class="fas fa-spa text-white text-2xl"></i>
          </div>
          <h5 class="text-gradient text-info">Bienvenue dans votre espace bien-être</h5>
          <p class="text-sm mb-0">
            Découvrez nos séances de méditation guidée spécialement conçues pour les étudiants.
          </p>
        </div>
        <div class="d-grid gap-2">
          <a href="{{ path('etudiant_meditation_index') }}" class="btn btn-primary">
            <i class="fas fa-spa me-2"></i> Explorer la méditation
          </a>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            Découvrir plus tard
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  
  // Graphique de progression
  const progressCtx = document.getElementById('progressChart').getContext('2d');
  const progressChart = new Chart(progressCtx, {
    type: 'doughnut',
    data: {
      labels: ['Complété', 'Restant'],
      datasets: [{
        data: [0, 100],
        backgroundColor: [
          '#4CAF50',
          '#e9ecef'
        ],
        borderWidth: 0,
        cutout: '80%'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          enabled: false
        }
      }
    }
  });
  
  // Animation des compteurs
  function animateCounter(element, target, duration) {
    let start = 0;
    const increment = target / (duration / 16);
    const timer = setInterval(() => {
      start += increment;
      if (start >= target) {
        element.textContent = target;
        clearInterval(timer);
      } else {
        element.textContent = Math.floor(start);
      }
    }, 16);
  }
  
  // Animer les compteurs principaux
  const counters = document.querySelectorAll('.font-weight-bolder.mb-0');
  counters.forEach(counter => {
    const text = counter.textContent.trim();
    if (text === '0' || text === '0 min' || text === 'Débutant') {
      // Ne pas animer les valeurs à 0
      return;
    }
    const target = parseInt(text.replace(/\D/g, ''));
    if (!isNaN(target) && target > 0) {
      counter.textContent = '0';
      animateCounter(counter, target, 2000);
    }
  });
  
  // Afficher le modal de bienvenue à la première visite
  if (!localStorage.getItem('welcomeShown')) {
    setTimeout(() => {
      const welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
      welcomeModal.show();
      localStorage.setItem('welcomeShown', 'true');
    }, 1000);
  }
  
  // Tooltips
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.forEach(tooltipTriggerEl => {
    new bootstrap.Tooltip(tooltipTriggerEl);
  });
  
  console.log('Dashboard étudiant chargé');
});
</script>
{% endblock %}